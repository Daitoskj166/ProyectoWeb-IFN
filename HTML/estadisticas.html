<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Generar Reporte - IFN</title>
  <!-- Enlace al archivo CSS espec√≠fico para estilos de reportes -->
  <link rel="stylesheet" href="../CSS/styles-Estadisticas.css">
  <!-- Importaci√≥n de Chart.js para generar gr√°ficos interactivos -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <!-- ===== ENCABEZADO PRINCIPAL ===== -->
  <header>
    <!-- Logo del Instituto de Hidrolog√≠a, Meteorolog√≠a y Estudios Ambientales -->
    <img class="Logo" src="../IMG/ifn-baja-tcm30-525131.png" alt="Logo IFN" width="150">
    
    <!-- Contenedor central del header con t√≠tulo y navegaci√≥n -->
    <div class="center-header">
      <h1>INVENTARIO FORESTAL NACIONAL - COLOMBIA</h1>
      
      <!-- Men√∫ de navegaci√≥n principal -->
      <div class="dashboard">
        <a href="inicio-Pantalla.html" class="dashboard-btn">Inicio</a>
        <a href="subirArbol.html" class="dashboard-btn">Subir Arbol</a>
        <a href="subirSuelo.html" class="dashboard-btn">Subir Suelo</a>
        <a href="registro.html" class="dashboard-btn">Registro</a>
        <a href="gestionBrigadas.html" class="dashboard-btn">Gesti√≥n Brigadas</a>
        <a href="supervision.html" class="dashboard-btn">Supervisi√≥n</a>
      </div>
    </div>

    <!-- Secci√≥n de informaci√≥n del usuario -->
    <div class="login-imagen">
      <p class="texto-arriba">User</p>
      <img class="Login" src="../IMG/login.png" alt="Login User" width="150">
      <button class="texto-abajo">Cerrar sesi√≥n</button>
    </div>
  </header>

  <!-- Banner que muestra el estado de conexi√≥n del sistema -->
  <div class="banner-conectado">
    <span class="banner-icon">üü¢</span>
    <span class="banner-texto">En l√≠nea - Datos se guardan autom√°ticamente</span>
  </div>

  <!-- ===== CONTENIDO PRINCIPAL DE LA P√ÅGINA ===== -->
  <main>
    <h1>GENERAR REPORTES</h1>
    
    <!-- SECCI√ìN DE FILTROS PARA PERSONALIZAR EL REPORTE -->
    <div class="filtros-reporte">
      <h2>Personalizar Reporte</h2>
      
      <!-- Grid responsivo para organizar los filtros -->
      <div class="filtros-grid">
        <!-- Filtro por tipo de reporte (obligatorio) -->
        <div class="filtro-grupo">
          <label for="tipo-reporte">Tipo de Reporte *</label>
          <select id="tipo-reporte" required>
            <option value="">Seleccionar tipo</option>
            <option value="arboles">Reporte de √Årboles</option>
            <option value="suelos">Reporte de Suelos</option>
            <option value="especies">Distribuci√≥n de Especies</option>
            <option value="crecimiento">An√°lisis de Crecimiento</option>
            <option value="salud">Estado de Salud Forestal</option>
          </select>
        </div>
        
        <!-- Filtro por per√≠odo de tiempo (obligatorio) -->
        <div class="filtro-grupo">
          <label for="periodo">Per√≠odo *</label>
          <select id="periodo" required>
            <option value="">Seleccionar per√≠odo</option>
            <option value="hoy">Hoy</option>
            <option value="semana">Esta semana</option>
            <option value="mes">Este mes</option>
            <option value="trimestre">Este trimestre</option>
            <option value="anio">Este a√±o</option>
            <option value="personalizado">Personalizado</option>
          </select>
        </div>
        
        <!-- Filtro opcional por ubicaci√≥n geogr√°fica -->
        <div class="filtro-grupo">
          <label for="ubicacion">Ubicaci√≥n</label>
          <select id="ubicacion">
            <option value="">Todas las ubicaciones</option>
            <option value="norte">Regi√≥n Norte</option>
            <option value="sur">Regi√≥n Sur</option>
            <option value="este">Regi√≥n Este</option>
            <option value="oeste">Regi√≥n Oeste</option>
            <option value="andes">Regi√≥n Andina</option>
            <option value="amazonia">Amazon√≠a</option>
            <option value="pacifico">Pac√≠fico</option>
            <option value="caribe">Caribe</option>
          </select>
        </div>
        
        <!-- Filtro opcional por brigada de campo -->
        <div class="filtro-grupo">
          <label for="brigada">Brigada</label>
          <select id="brigada">
            <option value="">Todas las brigadas</option>
            <option value="brigada1">Brigada Norte</option>
            <option value="brigada2">Brigada Sur</option>
            <option value="brigada3">Brigada Este</option>
            <option value="brigada4">Brigada Oeste</option>
            <option value="brigada5">Brigada Andina</option>
          </select>
        </div>
      </div>
      
      <!-- Filtros de fecha personalizada (se muestran solo cuando se selecciona "Personalizado") -->
      <div class="filtros-fecha" id="filtros-fecha" style="display: none;">
        <div class="filtro-grupo">
          <label for="fecha-inicio">Fecha Inicio</label>
          <input type="date" id="fecha-inicio">
        </div>
        
        <div class="filtro-grupo">
          <label for="fecha-fin">Fecha Fin</label>
          <input type="date" id="fecha-fin">
        </div>
      </div>
      
      <!-- Botones para gestionar los filtros -->
      <div class="botones-filtros">
        <button class="btn-limpiar" id="btnLimpiarFiltros">Limpiar Filtros</button>
        <button class="btn-aplicar" id="btnAplicarFiltros">Aplicar Filtros</button>
      </div>
    </div>
    
    <!-- SECCI√ìN DE VISTA PREVIA DEL REPORTE -->
    <div class="vista-previa">
      <h2>Vista Previa del Reporte</h2>
      
      <!-- Tarjetas con estad√≠sticas r√°pidas del reporte -->
      <div class="estadisticas-rapidas">
        <div class="estadistica-item">
          <span class="estadistica-numero" id="total-arboles">0</span>
          <span class="estadistica-texto">√Årboles Registrados</span>
        </div>
        <div class="estadistica-item">
          <span class="estadistica-numero" id="total-suelos">0</span>
          <span class="estadistica-texto">Muestras de Suelo</span>
        </div>
        <div class="estadistica-item">
          <span class="estadistica-numero" id="total-especies">0</span>
          <span class="estadistica-texto">Especies Diferentes</span>
        </div>
        <div class="estadistica-item">
          <span class="estadistica-numero" id="avance">0%</span>
          <span class="estadistica-texto">Avance del Inventario</span>
        </div>
      </div>
      
      <!-- Contenedor para los gr√°ficos del reporte -->
      <div class="graficos-reporte">
        <div class="grafico-container">
          <h3>Distribuci√≥n de Especies</h3>
          <!-- Canvas para el gr√°fico circular de distribuci√≥n de especies -->
          <canvas id="graficoEspecies"></canvas>
        </div>
        
        <div class="grafico-container">
          <h3>Registros por Mes</h3>
          <!-- Canvas para el gr√°fico de barras de registros por mes -->
          <canvas id="graficoRegistros"></canvas>
        </div>
      </div>
      
      <!-- Tabla con resumen detallado de los datos -->
      <div class="tabla-resumen">
        <h3>Resumen de Datos</h3>
        <table class="tabla-datos">
          <thead>
            <tr>
              <th>Especie</th>
              <th>Cantidad</th>
              <th>Altura Promedio (m)</th>
              <th>Di√°metro Promedio (cm)</th>
              <th>Condici√≥n</th>
            </tr>
          </thead>
          <tbody id="tabla-datos-body">
            <!-- Las filas de datos se insertar√°n din√°micamente mediante JavaScript -->
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- SECCI√ìN DE OPCIONES DE EXPORTACI√ìN -->
    <div class="opciones-exportacion">
      <h2>Opciones de Exportaci√≥n</h2>
      
      <!-- Selector de formato de exportaci√≥n -->
      <div class="formatos-exportacion">
        <div class="formato-opcion">
          <input type="radio" id="formato-pdf" name="formato" value="pdf" checked>
          <label for="formato-pdf">PDF (Formato de documento)</label>
        </div>
        
        <div class="formato-opcion">
          <input type="radio" id="formato-csv" name="formato" value="csv">
          <label for="formato-csv">CSV (Datos en tabla)</label>
        </div>
        
        <div class="formato-opcion">
          <input type="radio" id="formato-excel" name="formato" value="excel">
          <label for="formato-excel">Excel (Hoja de c√°lculo)</label>
        </div>
      </div>
      
      <!-- Botones de acci√≥n para exportar y compartir -->
      <div class="botones-exportacion">
        <button class="btn-exportar" id="btnExportar">
          <span class="btn-icon">üìä</span>
          Generar y Exportar Reporte
        </button>
        
        <button class="btn-compartir" id="btnCompartir">
          <span class="btn-icon">üìß</span>
          Compartir por Correo
        </button>
      </div>
    </div>
    
    <!-- Mensaje que se muestra cuando no hay datos para el reporte -->
    <div class="sin-datos" id="sinDatos" style="display: none;">
      <div class="sin-datos-icon">üìù</div>
      <h3>No hay datos para el reporte solicitado</h3>
      <p>No se encontraron registros que coincidan con los filtros aplicados.</p>
      <div class="sugerencias">
        <p><strong>Sugerencias:</strong></p>
        <ul>
          <li>Ampl√≠e el rango de fechas seleccionado</li>
          <li>Seleccione una ubicaci√≥n diferente</li>
          <li>Verifique que existan datos para el per√≠odo seleccionado</li>
        </ul>
      </div>
      <button class="btn-alternativo" id="btnVerTodos">Ver Todos los Registros</button>
    </div>
  </main>

  <!-- ===== PIE DE P√ÅGINA ===== -->
  <footer>
    <div class="footer-container">
      <p>üìç Direcci√≥n: Calle 25 D No. 110911, Colombia</p>
      <p>üìß Correo: contacto@ideam.gov.co | ‚òé Tel: +57 (601) 4442060</p>
      <div class="redes-sociales">
        <a href="https://www.facebook.com/ideam.instituto/?locale=es_LA"><img src="../IMG/facebook.png" alt="Facebook"></a>
        <a href="https://x.com/IDEAMColombia?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor"><img src="../IMG/X.jpeg" alt="X"></a>
        <a href="https://www.instagram.com/ideamcolombia/?hl=es"><img src="../IMG/instagram.png" alt="Instagram"></a>
        <a href="https://www.youtube.com/@InstitutoIDEAM"><img src="../IMG/youtube.png" alt="YouTube"></a>
      </div>
      <p>&copy; 2024 Proyecto Web IFN. Todos los derechos reservados.</p>
    </div>
  </footer>

  <!-- ===== SCRIPT CON LA L√ìGICA DE LA APLICACI√ìN ===== -->
  <script>
    // Espera a que el DOM est√© completamente cargado antes de ejecutar el c√≥digo
    document.addEventListener('DOMContentLoaded', function() {
      // ===== DECLARACI√ìN DE VARIABLES Y ELEMENTOS DEL DOM =====
      
      // Referencias a elementos de filtros
      const periodoSelect = document.getElementById('periodo');
      const filtrosFecha = document.getElementById('filtros-fecha');
      
      // Referencias a botones de acci√≥n
      const btnAplicarFiltros = document.getElementById('btnAplicarFiltros');
      const btnLimpiarFiltros = document.getElementById('btnLimpiarFiltros');
      const btnExportar = document.getElementById('btnExportar');
      const btnCompartir = document.getElementById('btnCompartir');
      const btnVerTodos = document.getElementById('btnVerTodos');
      
      // Referencia al contenedor de mensaje sin datos
      const sinDatos = document.getElementById('sinDatos');
      
      // ===== CONFIGURACI√ìN DE EVENT LISTENERS =====
      
      // Muestra u oculta los filtros de fecha personalizada seg√∫n la selecci√≥n
      periodoSelect.addEventListener('change', function() {
        if (this.value === 'personalizado') {
          filtrosFecha.style.display = 'flex'; // Muestra los filtros de fecha
        } else {
          filtrosFecha.style.display = 'none'; // Oculta los filtros de fecha
        }
      });
      
      // Aplica los filtros seleccionados y genera la vista previa
      btnAplicarFiltros.addEventListener('click', function() {
        generarVistaPrevia(); // Funci√≥n que procesa los filtros y actualiza la vista
      });
      
      // Limpia todos los filtros y restablece la vista
      btnLimpiarFiltros.addEventListener('click', function() {
        // Resetea todos los selects de filtros
        document.querySelectorAll('.filtros-grid select').forEach(select => {
          select.value = '';
        });
        
        // Resetea los filtros principales
        document.getElementById('tipo-reporte').value = '';
        document.getElementById('periodo').value = '';
        filtrosFecha.style.display = 'none'; // Oculta filtros de fecha
        
        // Limpia la vista previa mostrada
        limpiarVistaPrevia();
      });
      
      // Exporta el reporte en el formato seleccionado
      btnExportar.addEventListener('click', function() {
        // Obtiene el formato seleccionado (PDF, CSV o Excel)
        const formato = document.querySelector('input[name="formato"]:checked').value;
        exportarReporte(formato); // Funci√≥n que maneja la exportaci√≥n
      });
      
      // Comparte el reporte por correo electr√≥nico
      btnCompartir.addEventListener('click', function() {
        compartirReporte(); // Funci√≥n que maneja el env√≠o por correo
      });
      
      // Muestra todos los registros sin filtros aplicados
      btnVerTodos.addEventListener('click', function() {
        // Limpia los filtros principales
        document.getElementById('periodo').value = '';
        document.getElementById('ubicacion').value = '';
        document.getElementById('brigada').value = '';
        
        // Regenera la vista previa con todos los datos
        generarVistaPrevia();
      });
      
      // ===== FUNCIONES PRINCIPALES DE LA APLICACI√ìN =====
      
      /**
       * Genera la vista previa del reporte aplicando los filtros seleccionados
       * Simula una llamada a la base de datos y actualiza la interfaz
       */
      function generarVistaPrevia() {
        // Muestra indicador de carga (en implementaci√≥n real)
        mostrarCarga();
        
        // Simula un retardo de carga de datos (1.5 segundos)
        setTimeout(function() {
          // ===== DATOS DE EJEMPLO PARA DEMOSTRACI√ìN =====
          const datosEjemplo = {
            totalArboles: 142,     // Total de √°rboles registrados
            totalSuelos: 28,       // Total de muestras de suelo
            totalEspecies: 18,     // Total de especies diferentes
            avance: '65%',         // Porcentaje de avance del inventario
            especies: [            // Array con datos detallados por especie
              { 
                nombre: 'Quercus humboldtii', 
                cantidad: 42, 
                altura: 18.5, 
                diametro: 45.2, 
                condicion: 'Excelente' 
              },
              { 
                nombre: 'Ceroxylon quindiuense', 
                cantidad: 28, 
                altura: 22.3, 
                diametro: 38.7, 
                condicion: 'Buena' 
              },
              { 
                nombre: 'Anacardium excelsum', 
                cantidad: 15, 
                altura: 15.8, 
                diametro: 52.1, 
                condicion: 'Regular' 
              },
              { 
                nombre: 'Cedrela odorata', 
                cantidad: 12, 
                altura: 20.1, 
                diametro: 41.5, 
                condicion: 'Buena' 
              },
              { 
                nombre: 'Swietenia macrophylla', 
                cantidad: 8, 
                altura: 17.6, 
                diametro: 48.9, 
                condicion: 'Excelente' 
              }
            ]
          };
          
          // ===== ACTUALIZACI√ìN DE ESTAD√çSTICAS R√ÅPIDAS =====
          document.getElementById('total-arboles').textContent = datosEjemplo.totalArboles;
          document.getElementById('total-suelos').textContent = datosEjemplo.totalSuelos;
          document.getElementById('total-especies').textContent = datosEjemplo.totalEspecies;
          document.getElementById('avance').textContent = datosEjemplo.avance;
          
          // ===== ACTUALIZACI√ìN DE LA TABLA DE DATOS =====
          const tablaBody = document.getElementById('tabla-datos-body');
          tablaBody.innerHTML = ''; // Limpia la tabla existente
          
          // Itera sobre cada especie y crea una fila en la tabla
          datosEjemplo.especies.forEach(especie => {
            const fila = document.createElement('tr'); // Crea elemento tr (table row)
            fila.innerHTML = `
              <td>${especie.nombre}</td>
              <td>${especie.cantidad}</td>
              <td>${especie.altura}</td>
              <td>${especie.diametro}</td>
              <td>${especie.condicion}</td>
            `;
            tablaBody.appendChild(fila); // A√±ade la fila a la tabla
          });
          
          // ===== GENERACI√ìN DE GR√ÅFICOS =====
          generarGraficos();
          
          // Oculta el mensaje de "sin datos" ya que ahora hay informaci√≥n
          sinDatos.style.display = 'none';
          
          // Oculta el indicador de carga
          ocultarCarga();
        }, 1500); // Fin del setTimeout (simula carga de datos)
      }
      
      /**
       * Limpia toda la vista previa del reporte
       * Restablece estad√≠sticas, tabla y gr√°ficos a valores por defecto
       */
      function limpiarVistaPrevia() {
        // Restablece las estad√≠sticas a cero
        document.getElementById('total-arboles').textContent = '0';
        document.getElementById('total-suelos').textContent = '0';
        document.getElementById('total-especies').textContent = '0';
        document.getElementById('avance').textContent = '0%';
        
        // Limpia el contenido de la tabla
        document.getElementById('tabla-datos-body').innerHTML = '';
        
        // ===== LIMPIEZA DE GR√ÅFICOS EXISTENTES =====
        const graficoEspecies = document.getElementById('graficoEspecies');
        const graficoRegistros = document.getElementById('graficoRegistros');
        
        // Destruye instancias anteriores de gr√°ficos si existen
        if (window.graficoEspeciesInstancia) {
          window.graficoEspeciesInstancia.destroy();
        }
        
        if (window.graficoRegistrosInstancia) {
          window.graficoRegistrosInstancia.destroy();
        }
        
        // Muestra el mensaje indicando que no hay datos
        sinDatos.style.display = 'block';
      }
      
      /**
       * Genera y renderiza los gr√°ficos usando Chart.js
       * Crea un gr√°fico circular para especies y uno de barras para registros
       */
      function generarGraficos() {
        // ===== GR√ÅFICO CIRCULAR - DISTRIBUCI√ìN DE ESPECIES =====
        const ctxEspecies = document.getElementById('graficoEspecies').getContext('2d');
        window.graficoEspeciesInstancia = new Chart(ctxEspecies, {
          type: 'pie', // Tipo de gr√°fico circular
          data: {
            labels: [
              'Quercus humboldtii', 
              'Ceroxylon quindiuense', 
              'Anacardium excelsum', 
              'Cedrela odorata', 
              'Swietenia macrophylla', 
              'Otras'
            ],
            datasets: [{
              data: [42, 28, 15, 12, 8, 37], // Valores para cada categor√≠a
              backgroundColor: [               // Colores para cada segmento
                '#4CAF50', '#2196F3', '#FF9800', '#9C27B0', '#F44336', '#607D8B'
              ]
            }]
          },
          options: {
            responsive: true, // El gr√°fico se adapta al tama√±o del contenedor
            plugins: {
              legend: {
                position: 'right', // Leyenda a la derecha del gr√°fico
              },
              title: {
                display: true,
                text: 'Distribuci√≥n por Especie' // T√≠tulo del gr√°fico
              }
            }
          }
        });
        
        // ===== GR√ÅFICO DE BARRAS - REGISTROS POR MES =====
        const ctxRegistros = document.getElementById('graficoRegistros').getContext('2d');
        window.graficoRegistrosInstancia = new Chart(ctxRegistros, {
          type: 'bar', // Tipo de gr√°fico de barras
          data: {
            labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'], // Eje X - meses
            datasets: [
              {
                label: '√Årboles', // Etiqueta para la primera serie
                data: [25, 32, 28, 41, 36, 30], // Valores para √°rboles
                backgroundColor: '#4CAF50' // Color verde para √°rboles
              }, 
              {
                label: 'Suelos', // Etiqueta para la segunda serie
                data: [8, 10, 6, 12, 9, 7], // Valores para suelos
                backgroundColor: '#2196F3' // Color azul para suelos
              }
            ]
          },
          options: {
            responsive: true, // Gr√°fico responsivo
            scales: {
              y: {
                beginAtZero: true // El eje Y comienza en 0
              }
            }
          }
        });
      }
      
      /**
       * Simula la exportaci√≥n del reporte en el formato especificado
       * @param {string} formato - Formato de exportaci√≥n (pdf, csv, excel)
       */
      function exportarReporte(formato) {
        // Cambia el texto del bot√≥n para indicar proceso en curso
        btnExportar.innerHTML = '<span class="btn-icon">‚è≥</span> Generando...';
        btnExportar.disabled = true; // Deshabilita el bot√≥n durante el proceso
        
        // Simula el tiempo de generaci√≥n del reporte (2 segundos)
        setTimeout(function() {
          // Muestra alerta de √©xito (en implementaci√≥n real descargar√≠a el archivo)
          alert(`Reporte generado exitosamente en formato ${formato.toUpperCase()}. El archivo se descargar√° autom√°ticamente.`);
          
          // Restablece el bot√≥n a su estado original
          btnExportar.innerHTML = '<span class="btn-icon">üìä</span> Generar y Exportar Reporte';
          btnExportar.disabled = false;
          
          // En una implementaci√≥n real, aqu√≠ se generar√≠a y descargar√≠a el archivo
          // seg√∫n el formato seleccionado
        }, 2000);
      }
      
      /**
       * Simula el env√≠o del reporte por correo electr√≥nico
       * Solicita el correo destino y muestra confirmaci√≥n
       */
      function compartirReporte() {
        // Solicita al usuario que ingrese un correo electr√≥nico
        const email = prompt('Ingrese el correo electr√≥nico para compartir el reporte:');
        
        // Si el usuario ingres√≥ un correo (no cancel√≥)
        if (email) {
          // Cambia el texto del bot√≥n para indicar env√≠o en curso
          btnCompartir.innerHTML = '<span class="btn-icon">‚è≥</span> Enviando...';
          btnCompartir.disabled = true; // Deshabilita el bot√≥n
          
          // Simula el tiempo de env√≠o (1.5 segundos)
          setTimeout(function() {
            // Muestra confirmaci√≥n de env√≠o exitoso
            alert(`Reporte compartido exitosamente a ${email}`);
            
            // Restablece el bot√≥n a su estado original
            btnCompartir.innerHTML = '<span class="btn-icon">üìß</span> Compartir por Correo';
            btnCompartir.disabled = false;
          }, 1500);
        }
      }
      
      /**
       * Muestra un indicador de carga (placeholder para implementaci√≥n real)
       * En una implementaci√≥n completa mostrar√≠a un spinner o barra de progreso
       */
      function mostrarCarga() {
        // En una implementaci√≥n real, aqu√≠ se mostrar√≠a un spinner de carga
        console.log('Cargando datos...'); // Mensaje de consola para desarrollo
      }
      
      /**
       * Oculta el indicador de carga (placeholder para implementaci√≥n real)
       */
      function ocultarCarga() {
        // En una implementaci√≥n real, aqu√≠ se ocultar√≠a el spinner de carga
        console.log('Datos cargados'); // Mensaje de consola para desarrollo
      }
      
      // ===== INICIALIZACI√ìN DE LA APLICACI√ìN =====
      
      // Inicializa la vista con estado vac√≠o (sin datos)
      limpiarVistaPrevia();
    });
  </script>
  <script src="../JS/estadisticas.js"></script>
  <script src="../JS/auth.js"></script>
</body>
</html>